#!/bin/bash

set -e


echo "==> aur and grub..."
### cachyos-repo
curl https://mirror.cachyos.org/cachyos-repo.tar.xz -o cachyos-repo.tar.xz
tar xvf cachyos-repo.tar.xz && cd cachyos-repo
sudo ./cachyos-repo.sh

### chaotic-aur
# Add chaotic AUR keys and repository if not added, else skip
echo "Adding chaotic AUR keys and repository"
if ! pacman-key --list-keys chaotic-aur &> /dev/null; then
  echo "Adding chaotic AUR keys and repository"
  sudo pacman-key --recv-key 3056513887B78AEB --keyserver keyserver.ubuntu.com
  sudo pacman-key --lsign-key 3056513887B78AEB
  sudo pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-keyring.pkg.tar.zst'
  sudo pacman -U 'https://cdn-mirror.chaotic.cx/chaotic-aur/chaotic-mirrorlist.pkg.tar.zst'
  echo "Chaotic AUR keys added successfully"
else
  echo "Chaotic AUR keys and repository already added. Skipping..."
fi

# Add chaotic AUR
if ! grep -q "^\[chaotic-aur\]" /etc/pacman.conf; then
  echo "[chaotic-aur]
Include = /etc/pacman.d/chaotic-mirrorlist" | sudo tee -a /etc/pacman.conf
  sudo pacman -Sy
  echo "Chaotic AUR repository added/updated successfully"
fi

sudo pacman -Syu



echo -e "\nâœ… GRUB tweaks applied! Reboot your system to take effect."

###### paru and yay ########
sudo pacman -Sy --noconfirm yay paru

echo "==> Installing packages..."
yay -Sy --noconfirm \
  7zip XWayland abiword acpi adobe-source-sans-fonts adobe-source-serif-fonts aic94xx-firmware alacritty alacritty-themes alsa-firmware alsa-plugins alsa-utils amd-ucode antimicrox appimagelauncher appmenu-gtk-module appstream appstream-glib appstream-qt5 aquamarine arandr arc-gtk-theme-eos arch-update archiso archlinux-tweak-tool-git archlinux-xdg-menu ardour aria2 arj aspell atril audacious audacity auto-cpufreq autorandr autostart autotiling avahi avizo awesome-terminal-fonts aylurs-gtk-shell azote b43-fwcutter baka-mplayer baobab base base-devel base16-alacritty-git bash-completion bat battop bc beautyline bemenu-wayland bibata-cursor-theme bibata-cursor-translucent bibata-extra-cursor-theme bibata-rainbow-cursor-theme bind bleachbit blender blueberry blueman bluetooth-support bluez-utils boost bottles bottom boxtron brave-bin breeze bridge-utils brightnessctl brltty broadcom-wl-dkms btop btrfs-assistant btrfs-du btrfs-progs btrfsmaintenance bzip2 calamares calcurse calf capitaine-cursors carla catfish catppuccin-cursors-git cava celluloid chezmoi chiaki clapper cliphist clipman clonezilla cloud-init cockpit cockpit-machines codeblocks conky-lua-archers converseen corectrl coreutils cpuid cpupower cryptsetup cups cups-browsed cups-pdf cups-pk-helper curl curlftpfs darkhttpd darktable dart-sass ddrescue deluge dex dhclient dhcpcd dialog diffutils digikam discord dmenu dmidecode dmraid dnsmasq dosfstools dotnet-host dotnet-runtime downgrade dracula-cursors-git dracula-gtk-theme dracula-gtk-theme-git dracula-icons-git dracut dua-cli duf dunst dunstctl dvgrab dxvk-bin dxvk-mingw-git e2fsprogs earlyoom easyeffects ecryptfs-utils edid-decode-git edk2-shell efibootmgr efitools egl-wayland emacs enchant engrampa eog epiphany espeakup ethtool evince exfatprogs exo expac eza f2fs-tools fail2ban falkon fastfetch fatresize feh festival ffmpegthumbnailer ffmpegthumbs file file-roller filesystem filezilla find-the-command findutils firefox firejail fish flameshot flashplugin flat-remix-git flatpak flavours fluent-gtk-theme font-manager foomatic-db foomatic-db-engine foomatic-db-gutenprint-ppds foomatic-db-nonfree foomatic-db-nonfree-ppds foomatic-db-ppds foot fpc freetype2 frei0r-plugins fsarchiver fscrypt fsearch fuse2fs fuzzel fwupd fzf galculator gamemode gamescope gamescope-session-git garcon gawk gcc-libs gcolor3 gdb geany geany-plugins geary gedit geekbench gestures gettext gimp git github-cli github-desktop gksu glances glava glibc gmtp gnome-boxes gnome-disk-utility gnome-firmware gnome-keyring gnu-netcat google-chrome gopsuinfo goverlay gpart gparted gpm gptfdisk gpu-screen-recorder-git graphite-gtk-theme-git greetd greetd-regreet grep grilo-plugins grim grimshot grub grub-btrfs grub-customizer gruvbox gsfonts gsimplecal gst-libav gst-plugin-pipewire gst-plugins-bad gst-plugins-base gst-plugins-good gst-plugins-ugly gstreamer gstreamer-meta gstreamer-vaapi gthumb gtk-engine-murrine gtk-layer-shell gtkhash gtkhash-thunar gtklock gtklock-playerctl-module gtklock-powerbar-module gtklock-userinfo-module gufw gutenprint gvfs gvfs-afc gvfs-dnssd gvfs-goa gvfs-google gvfs-gphoto2 gvfs-mtp gvfs-nfs gvfs-onedrive gvfs-smb gvfs-wsdd gvim gzip hardinfo2 haveged hdparm heroic-games-launcher-bin hexchat hplip htop hunspell-fr hw-probe hwdetect hwinfo hydrogen hyperv iftop ifuse imagemagick imdb-thumbnailer imv indentLine inetutils inkscape input-devices-support insync-thunar intel-media-driver intel-ucode inxi iproute2 iptables-nft iputils irssi iw iwd jacktrip jfsutils joystickwake jq jre8-openjdk kanshi kate kazam kdenlive keepassxc kitty kitty-terminfo konsole kooha krita krita-plugin-gmic kvantum kvantum-qt5 kvantum-theme-materia kvantum-theme-nordic-git kvantum-theme-qogir-git lact languagetool layan-gtk-theme-git lazygit ldns leafpad less lftp lhasa lib32-gamemode lib32-libva-mesa-driver lib32-mangohud lib32-mesa lib32-mesa-vdpau lib32-pipewire-jack lib32-vulkan-icd-loader lib32-vulkan-mesa-layers lib32-vulkan-radeon libdvdcss libfido2 libgsf libmythes libnotify libopenraw libpulse libreoffice-fresh librewolf librsvg libusb-compat libva-intel-driver libva-mesa-driver libxinerama licenses light linux linux-atm linux-firmware linux-firmware-marvell linux-headers linux-zen linux-zen-headers livecd-sounds lm_sensors lmms logrotate lohit-fonts lolcat loupe lrzip lsb-release lsd lshw lsp-plugins-lv2 lsscsi luarocks lutris lvm2 lxappearance lxmusic lynx lzip lzop make mako malcontent man-db man-pages mangohud materia-gtk-theme mc mcfly mda.lv2 mdadm meld memtest86+ memtest86+-efi menulibre menus mesa meson micro microsoft-edge-stable-bin mintstick mission-center mixxx mkinitcpio mkinitcpio-archiso mkinitcpio-firmware mkinitcpio-nfs-utils mkinitcpio-openswap modemmanager most mousepad mousetweaks movit mpc mpd mpdris2 mpv mpv-mpris mtools mtpfs mugshot muse mystiq mythes-en nano nano-syntax-highlighting nautilus navi nbd ncmpcpp ndisc6 neofetch neovim neovim-coc-zsh-git nerd-fonts-source-code-pro nerdtree net-tools netctl network-manager-applet networkmanager networkmanager-openconnect networkmanager-openvpn networkmanager-pptp networkmanager-support networkmanager-vpnc newsboat nfs-utils nilfs-utils nitrogen nlohmann-json nm-applet nmap nordic-darker-theme noto-fonts noto-fonts-cjk noto-fonts-emoji noto-fonts-extra nss-mdns ntfs-3g ntp numix-gtk-theme-git numlockx nwg-displays nwg-drawer nwg-hello nwg-icon-picker nwg-launchers nwg-look nwg-menu nwg-panel obsidian obsidian-icon-theme octopi oh-my-posh-bin oh-my-zsh-powerline-theme-git okular open-iscsi open-vm-tools opencolorio openconnect opencv openresolv openrgb openshot openssh opentimelineio openvpn opera opus-tools orca os-prober os-prober-btrfs otf-font-awesome otf-libertinus p7zip pace pacman pacman-contrib pacseek pamac pamixer papirus-icon-theme parole partclone parted partimage paru pavucontrol pciutils pcsclite pdfarranger peek perl-file-mimeinfo pev picom pinta piper pipewire pipewire-alsa pipewire-jack pipewire-pulse pitivi pkgfile playerctl plocate polkit-gnome polykit popsicle power-profiles-daemon powerpill powertop ppp pptpclient printer-support procps-ng proton-ge-custom-bin psd psmisc pulse putty pv python-gobject python-pip python-pyparted python-pyquery python-pywal python-requests python-ttkbootstrap qalculate-gtk qbittorrent qemu-guest-agent qogir-gtk-theme-git qpdfview qpwgraph qsynth qt5 qt5-3d qt5-charts qt5-connectivity qt5-datavis3d qt5-doc qt5-examples qt5-graphicaleffects qt5-imageformats qt5-networkauth qt5-quick3d qt5-quickcontrols2 qt5-remoteobjects qt5-scxml qt5-sensors qt5-serialport qt5-speech qt5-tools qt5-virtualkeyboard qt5-wayland qt5-websockets qt5ct qt6-wayland qt6ct qtcreator qtractor r ranger rate-mirrors realtime-privileges rebuild-detector redshift refind reflector reflector-simple reiserfsprogs replay-sorcery retroarch ripgrep-all ristretto rnnoise rocm-hip-runtime rocm-opencl-runtime rofi rofi-calc rofi-lbonn-wayland rofi-wayland rp-pppoe rsync rtkit rtl8821cu-morrownr-dkms-git rxvt-unicode-terminfo rygel s-nail s-tui samba samba-support sane sardi-icons sassc scanner-support screen scrot scummvm sddm sdparm sed sg3_utils sgsearch shadow shairport-sync shotwell simple-scan simplescreenrecorder slurp smartmontools smplayer smplayer-skins smplayer-themes snapd snapper-support snapper-tools snapshot sof-firmware sofirem-git sox speex speexdsp splix spotify spotify-launcher squashfs-tools sshfs starship steam stow strace sublime-text-4 sudo sushi swappy sway-contrib swaybg swayfx swayidle swayimg swaylock-effects swaync swayr sweet-cursor-theme-git sweet-gtk-theme-dark swww syslinux sysstat system-config-printer systemd systemd-resolvconf systemd-sysvcompat systemd-ui tagbar tar task taskell tcpdump tecla terminus-font testdisk the_silver_searcher thefuck thunar thunar-archive-plugin thunar-media-tags-plugin thunar-shares-plugin thunar-volman thunar-volman-devel thunarx-python thunderbird timeshift timeshift-autosnap tk tldr tmux tokyonight-gtk-theme-git totem tpm2-tss traceroute translate-shell transmission-gtk tree trizen ttf-anonymous-pro ttf-bitstream-vera ttf-caladea ttf-carlito ttf-cascadia-code ttf-cormorant ttf-croscore ttf-dejavu ttf-droid ttf-eurof ttf-fantasque-sans-mono ttf-fira-code ttf-fira-mono ttf-fira-sans ttf-font-awesome ttf-hack ttf-hactor ttf-hellvetica ttf-ibm-plex ttf-inconsolata ttf-iosevka-nerd ttf-jetbrains-mono ttf-jetbrains-mono-nerd ttf-joypixels ttf-lato ttf-liberation ttf-linux-libertine ttf-linux-libertine-g ttf-mac-fonts ttf-meslo-nerd ttf-meslo-nerd-font-powerlevel10k ttf-monofur ttf-ms-fonts ttf-nerd-fonts-symbols ttf-nerd-fonts-symbols-mono ttf-opensans ttf-roboto ttf-roboto-mono ttf-sourcecodepro-nerd ttf-ubuntu-font-family tumbler udate-grub udftools udiskie udisks2 ueberzug ufw ugrep unace unarchiver unarj unrar unzip upd72020x-fw usb_modeswitch usbmuxd usbutils util-linux ventoy-bin veracrypt vi vim vimix-cursors vimix-gtk-themes vimix-icon-theme visual-studio-code-bin vivaldi vivaldi-ffmpeg-codecs vivaldi-widevine vkbasalt vlc volumeicon vpnc vscodium vulkan-icd-loader vulkan-intel vulkan-mesa-layers vulkan-nouveau vulkan-radeon waybar waybar-module-pacman-updates-git wayland wayland-protocols wayland-utils wd719x-firmware we10x-icon-theme-git wf-recorder wget which whitesur-icon-theme-git whois wine-installer winetricks wireless-regdb wireless_tools wireplumber wl-clipboard wl-clipboard-history-git wlogout wlr-randr wlroots wlsunset wmcliphist wmenu wofi wpa_supplicant wqy-zenhei wtype wvdial xarchiver xarchiver-gtk2 xautolock xbindkeys xcape xclip xdg-desktop-portal xdg-desktop-portal-wlr xdg-desktop-portal-xapp xdg-user-dirs xdg-user-dirs-gtk xdg-utils xdiff-ext-git xdotool xed xf86-input-elographics xf86-input-libinput xf86-video-amdgpu xf86-video-ati xf86-video-nouveau xf86-video-vmware xfburn xfce4 xfce4-appfinder xfce4-artwork xfce4-battery-plugin xfce4-clipman-plugin xfce4-cpufreq-plugin xfce4-cpugraph-plugin xfce4-dict xfce4-diskperf-plugin xfce4-eyes-plugin xfce4-fsguard-plugin xfce4-genmon-plugin xfce4-goodies xfce4-mailwatch-plugin xfce4-mount-plugin xfce4-mpc-plugin xfce4-netload-plugin xfce4-notes-plugin xfce4-notifyd xfce4-panel xfce4-places-plugin xfce4-power-manager xfce4-pulseaudio-plugin xfce4-screensaver xfce4-screenshooter xfce4-sensors-plugin xfce4-session xfce4-settings xfce4-smartbookmark-plugin xfce4-systemload-plugin xfce4-taskmanager xfce4-terminal xfce4-time-out-plugin xfce4-timer-plugin xfce4-verve-plugin xfce4-wavelan-plugin xfce4-weather-plugin xfce4-whiskermenu-plugin xfce4-xkb-plugin xfconf xfdesktop xfsprogs xfwm4 xfwm4-themes xl2tpd xorg-bdftopcf xorg-iceauth xorg-mkfontscale xorg-server xorg-server-xephyr xorg-sessreg xorg-setxkbmap xorg-smproxy xorg-x11perf xorg-xauth xorg-xbacklight xorg-xcmsdb xorg-xcursorgen xorg-xdpyinfo xorg-xdriinfo xorg-xev xorg-xgamma xorg-xhost xorg-xinit xorg-xinput xorg-xkbcomp xorg-xkbevd xorg-xkbprint xorg-xkbutils xorg-xkill xorg-xlsatoms xorg-xlsclients xorg-xmodmap xorg-xpr xorg-xprop xorg-xrandr xorg-xrdb xorg-xrefresh xorg-xset xorg-xsetroot xorg-xvinfo xorg-xwayland xorg-xwd xorg-xwininfo xorg-xwud xpadneo-dkms xpdf xreader xsel xsettingsd xss-lock xz yad yaru-icon-theme yay zam-plugins-lv2 zathura zathura-cb zathura-djvu zathura-pdf-mupdf zathura-ps zip zita-convolver zoxide zram-generator zsh zsh-autocomplete zsh-autosuggestions zsh-completions zsh-history-substring-search zsh-syntax-highlighting nm-connection-editor


echo "==> Installing latest Swaylock-effects and ProtonGE (optional)..."
yay -S --noconfirm --needed swaylock-effects proton-ge-custom

echo "==> Copying configs..."
cp -r config/* ~/.config/
cp install_swayfx_amd_gaming.sh ~/

echo "==> Applying system tweaks (may require sudo)..."
echo "fs.inotify.max_user_watches=524288" | sudo tee /etc/sysctl.d/99-amd-gaming.conf
echo "fs.file-max=1048576" | sudo tee -a /etc/sysctl.d/99-amd-gaming.conf
echo "vm.max_map_count=1048576" | sudo tee -a /etc/sysctl.d/99-amd-gaming.conf
echo "vm.swappiness=10" | sudo tee -a /etc/sysctl.d/99-amd-gaming.conf

echo 'ACTION=="add", SUBSYSTEM=="drm", KERNEL=="card[0-9]*", RUN+="/usr/bin/sh -c '\''echo performance > /sys/class/drm/%k/device/power_dpm_force_performance_level'\''"' | sudo tee /etc/udev/rules.d/99-amd-performance.rules

echo "==> Done!"
echo "Reboot and launch SwayFX!"
